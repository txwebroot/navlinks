# VPS 主机管理应用 - 需求规格说明书及开发计划

## 1. 项目概述
本项目旨在 `apps` 目录下构建一个名为 **"VPS"** 的轻量级服务器管理应用。该应用将提供一站式的服务器运维能力，核心功能包括服务器列表管理、实时资源监控、Web SSH 终端、文件管理以及快捷脚本库。目标是让用户能够通过浏览器高效地管理和维护多台 Linux 服务器。

## 2. 功能需求详解

### 2.1 服务器列表与管理
*   **服务器分组**：支持自定义分组（如：生产环境、测试环境、数据库等），方便管理大量服务器。
*   **增删改查**：支持添加、编辑、删除服务器信息。
*   **认证方式**：
    *   **密码认证**：支持保存 SSH 密码（需加密存储）。
    *   **密钥认证**：支持上传私钥文件或粘贴私钥内容（需加密存储）。
*   **状态概览**：在列表页显示服务器的基础状态（在线/离线）。
    *   *优化策略*：列表页仅通过轻量级 TCP Ping 或 SSH 握手检测在线状态，避免建立完整连接，减少资源消耗。

### 2.2 资源监控 (Resource Monitoring)
*   **按需连接**：鉴于实时监控多台服务器对宿主机（运行本应用的机器）网络和 CPU 有压力，**监控仅在进入特定服务器详情页或打开终端时启动**。
*   **监控指标**：
    *   **基础指标**：CPU 使用率、内存使用情况、磁盘空间（根目录及挂载点）。
    *   **网络指标**：实时上传速率、下载速率。
    *   **系统信息**：主机名、OS 版本、运行时间 (Uptime)。
*   **实现方式**：建立 SSH 连接后，通过轻量级命令（如 `top`, `free`, `df`, `/proc/net/dev`）定期（如每 2-3 秒）抓取数据并推送到前端。

### 2.3 Web SSH 终端 (Web Terminal)
*   **核心功能**：基于 Web 的 SSH 客户端，提供接近原生终端的体验。
*   **特性支持**：
    *   支持全屏/窗口模式。
    *   支持终端大小自适应 (Resize)。
    *   支持复制/粘贴。
    *   支持 ANSI 颜色显示。
    *   支持多会话管理（同时打开多个终端）。

### 2.4 文件管理 (File Management)
*   **文件浏览器**：以树形或列表形式展示服务器文件系统。
*   **基本操作**：
    *   **浏览**：进入目录、返回上级、刷新。
    *   **上传**：支持拖拽上传文件/文件夹到当前目录。
    *   **下载**：下载服务器文件到本地。
    *   **编辑**：内置简易文本编辑器，在线修改配置文件。
    *   **管理**：新建文件/文件夹、删除、重命名、修改权限 (chmod)。

### 2.5 快捷指令/脚本库 (Snippets Library)
*   **脚本管理**：
    *   **分类存储**：按用途分类（如：系统初始化、Docker管理、日志清理）。
    *   **CRUD**：新增、编辑、删除脚本/命令片段。
    *   **备注说明**：为每个脚本添加用途描述。
*   **快速执行**：
    *   **侧边栏集成**：在 SSH 终端页面侧边栏显示脚本库。
    *   **一键发送**：点击脚本即可将其内容自动填充或发送到当前活动的 SSH 终端并执行。

### 2.6 集成工作台 (Integrated Workspace)
*   **布局设计**：采用“三栏式”或“分屏”布局，在一个视窗内同时提供：
    *   **左侧/右侧**：文件管理器 & 脚本库（可折叠/切换）。
    *   **中心/底部**：SSH 终端窗口。
    *   **顶部**：实时资源监控仪表盘。
*   此设计允许用户一边查看文件列表，一边执行命令，同时监控服务器响应。

## 3. 技术架构与方案

### 3.1 前端技术栈
*   **框架**：React + TypeScript + Tailwind CSS。
*   **终端组件**：`xterm.js`（业界标准的 Web 终端库） + `xterm-addon-fit`。
*   **UI 组件**：复用现有的通用组件，针对文件树和终端布局开发新组件。

### 3.2 后端技术栈
*   **运行时**：Node.js。
*   **SSH 协议**：`ssh2` 库（Node.js 下最成熟的 SSH 客户端实现）。
*   **实时通信**：`socket.io`（用于双向传输终端数据流和监控数据）。
*   **数据库**：SQLite（存储服务器配置、脚本数据，**敏感字段需 AES 加密**）。

### 3.3 数据流向
1.  **终端流**：Browser (xterm.js) <-> Socket.io <-> Node.js (ssh2 stream) <-> Target Server (Shell)。
2.  **文件流**：Browser <-> HTTP API <-> Node.js (SFTP) <-> Target Server。
3.  **监控流**：Node.js 定时执行命令 -> 解析结果 -> Socket.io -> Browser。

## 4. 数据库设计 (Draft)

### 4.1 `vps_servers` 表
| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | TEXT | UUID |
| name | TEXT | 服务器名称 |
| group_id | TEXT | 分组ID |
| host | TEXT | IP地址或域名 |
| port | INTEGER | SSH端口 (默认22) |
| username | TEXT | SSH用户名 |
| password | TEXT | 加密后的密码 (可选) |
| private_key | TEXT | 加密后的私钥 (可选) |
| description | TEXT | 备注 |

### 4.2 `vps_snippets` 表
| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | TEXT | UUID |
| category | TEXT | 分类名称 |
| title | TEXT | 脚本标题 |
| command | TEXT | 脚本内容 |
| description | TEXT | 备注 |

## 5. 开发计划

### 第一阶段：基础架构与服务器管理 (预计 1-2 天)
1.  初始化 `apps/vps` 目录结构。
2.  设计并创建数据库表 (`vps_servers`, `vps_groups`)。
3.  实现服务器列表页（CRUD、分组展示）。
4.  实现后端 SSH 连接测试接口。

### 第二阶段：Web SSH 终端核心 (预计 2-3 天)
1.  后端集成 `socket.io` 和 `ssh2`。
2.  前端集成 `xterm.js`。
3.  打通前后端 WebSocket 通道，实现基础的终端交互。
4.  处理终端 Resize 和断线重连。

### 第三阶段：资源监控与集成工作台 (预计 2 天)
1.  实现后端监控服务（通过 SSH 执行 `top`/`free` 等命令）。
2.  前端开发“集成工作台”布局（终端+仪表盘）。
3.  实现实时数据展示。

### 第四阶段：文件管理与脚本库 (预计 2-3 天)
1.  后端实现 SFTP 封装（列出目录、上传、下载）。
2.  前端开发文件管理器组件。
3.  实现脚本库的 CRUD 和“一键发送到终端”功能。

### 第五阶段：测试与优化 (预计 1-2 天)
1.  安全性检查（敏感数据加密）。
2.  移动端适配（主要适配列表页和简单监控，终端在手机上操作较难，做基础适配）。
3.  整体 Bug 修复和 UI 细节打磨。

---
**总结**：该计划优先保证核心的 SSH 连接和管理体验，通过“按需连接”解决资源占用问题，并利用 WebSocket 实现流畅的实时交互。
